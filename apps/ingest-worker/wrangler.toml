name = "compliance-ingest-worker"
main = "src/index.ts"
compatibility_date = "2026-02-15"
workers_dev = true

[vars]
ENV_NAME = "dev"

[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "compliance-docs-dev"

[[d1_databases]]
binding = "DB"
database_name = "compliance-dev"
database_id = "REPLACE_WITH_DEV_D1_ID"

[[vectorize]]
binding = "VECTORIZE_INDEX"
index_name = "compliance-dev-index"

[[queues.consumers]]
queue = "compliance-ingest-dev"
max_batch_size = 10
max_batch_timeout = 5

[env.staging.vars]
ENV_NAME = "staging"

[[env.staging.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "compliance-docs-staging"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "compliance-staging"
database_id = "REPLACE_WITH_STAGING_D1_ID"

[[env.staging.vectorize]]
binding = "VECTORIZE_INDEX"
index_name = "compliance-staging-index"

[[env.staging.queues.consumers]]
queue = "compliance-ingest-staging"
max_batch_size = 10
max_batch_timeout = 5

[env.prod.vars]
ENV_NAME = "prod"

[[env.prod.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "compliance-docs-prod"

[[env.prod.d1_databases]]
binding = "DB"
database_name = "compliance-prod"
database_id = "REPLACE_WITH_PROD_D1_ID"

[[env.prod.vectorize]]
binding = "VECTORIZE_INDEX"
index_name = "compliance-prod-index"

[[env.prod.queues.consumers]]
queue = "compliance-ingest-prod"
max_batch_size = 20
max_batch_timeout = 5
